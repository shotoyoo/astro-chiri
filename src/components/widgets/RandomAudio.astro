---
import AudioCard from '@/components/widgets/AudioCard.astro'
import { getAudioCsv } from '@/utils/audioCsv'

interface Props {
  /**
   * Directory path within content/audio to scan (e.g., "featured", "recent")
   * If not provided or empty string, scans the root audio directory
   */
  directory?: string
  description?: string
}

const { directory = '', description = '' } = Astro.props

// Generate unique ID for this instance
const containerId = `random-audio-container-${directory || 'root'}`

const filteredAudio = directory ? getAudioCsv(directory) : []
---

<h3 class="mb-1" style="margin-left: 1rem;">{description}</h3>
<div id={containerId} class="card bg-base-100 mt-1 mb-4 min-w-full p-2 pb-2 shadow-md">
  {filteredAudio.map((audio) => (
    <div class="audio-card-item hidden" data-audio-id={audio.id}>
      <AudioCard
        title={audio.title}
        desc={audio.description}
        audioUrl={audio.audioUrl}
        youtubeId={audio.youtubeId}
        date={audio.date}
        id={audio.id}
      />
    </div>
  ))}
</div>

<script define:vars={{ containerId }}>
  // Client-side random selection
  function showRandomAudio() {
    const container = document.getElementById(containerId)
    if (!container) return
    
    const audioItems = container.querySelectorAll('.audio-card-item')
    if (audioItems.length === 0) return
    
    // Hide all items
    audioItems.forEach(item => item.classList.add('hidden'))
    
    // Show a random one
    const randomIndex = Math.floor(Math.random() * audioItems.length)
    audioItems[randomIndex].classList.remove('hidden')
  }
  
  // Run on page load
  showRandomAudio()
  
  // Re-run on view transitions
  document.addEventListener('astro:page-load', showRandomAudio)
</script>
</script>
