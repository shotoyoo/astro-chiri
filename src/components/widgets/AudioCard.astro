---
import dayjs from "dayjs";
import localizedFormat from "dayjs/plugin/localizedFormat";

dayjs.extend(localizedFormat);

const { title, cover, desc, audioUrl, youtubeId, id, date } = Astro.props;

const coverImage = cover || "cover-images/defaultCover.jpg";
const displayDate = dayjs(date).format("ll");

// YouTubeリンクの場合の処理
const isYouTube = !!youtubeId;
const displayTitle = isYouTube ? `${title} (from YouTube)` : title;
const youtubeUrl = youtubeId ? `https://www.youtube.com/watch?v=${youtubeId}` : null;
---

<div class="audio-card" data-active="false">
  <div class="hero-content flex-row items-start py-2">
    <div class="w-full grow overflow-auto">
      {isYouTube && youtubeUrl ? (
        <h2 class="audio-card-title truncate font-semibold">
          <a href={youtubeUrl} target="_blank" rel="noopener noreferrer" class="youtube-title-link">
            {displayTitle}
          </a>
        </h2>
      ) : (
        <h2 class="audio-card-title truncate font-semibold">{displayTitle}</h2>
      )}
      <p class="text-xs font-medium opacity-90">
        {displayDate}
      </p>
      <p class="my-1 line-clamp-2 text-xs md:text-sm">{desc}</p>
    </div>

    <label
      class="btn btn-circle swap md:mx-2 shrink-0"
      aria-label="Toggle play and pause"
    >
      <input
        type="checkbox"
        class="card-pay-buttons"
        id={id}
        data-audio-url={audioUrl}
        data-youtube-id={youtubeId}
        aria-label="Play and pause"
      />
      <div class="swap-off">
        <!-- Play icon -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <polygon
            points="5 3 19 12 5 21 5 3"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></polygon>
        </svg>
      </div>
      <div class="swap-on">
        <!-- Pause icon -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <rect x="6" y="4" width="4" height="16" stroke-width="2"></rect>
          <rect x="14" y="4" width="4" height="16" stroke-width="2"></rect>
        </svg>
      </div>
    </label>
  </div>

  <hr class="border-base-content my-2 opacity-[.15]" />
</div>

<style>
  .audio-card:last-child hr {
    display: none;
  }

  /* Title styling with CSS variable */
  .audio-card-title {
    font-size: var(--font-size-s);
  }

  /* YouTube title link styling */
  .youtube-title-link {
    color: inherit;
    text-decoration: none;
    transition: opacity 0.2s ease;
  }

  .youtube-title-link:hover {
    opacity: 0.7;
    text-decoration: underline;
  }

  /* Optional: Highlight active card */
  .audio-card[data-active="true"] {
    background-color: rgba(0, 0, 0, 0.05); /* subtle highlight */
    border-radius: 0.5rem;
  }
</style>
